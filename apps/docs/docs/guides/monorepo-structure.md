---
sidebar_position: 1
---

# Monorepo ç»“æ„

NX libs ä½¿ç”¨ monorepo ç»“æ„ç»„ç»‡ä»£ç ï¼ŒåŸºäº pnpm workspace å’Œ Turborepo æ„å»ºã€‚è¿™ç§ç»“æ„ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªä»£ç åº“ä¸­ç®¡ç†å¤šä¸ªç›¸å…³ä½†ç‹¬ç«‹çš„åŒ…ï¼ŒåŒæ—¶å…±äº«é…ç½®å’Œå·¥å…·ã€‚

## ç›®å½•ç»“æ„

```
nx-libs/
â”œâ”€â”€ apps/                   # åº”ç”¨ç¨‹åº
â”‚   â””â”€â”€ docs/               # æ–‡æ¡£ç½‘ç«™ (Docusaurus)
â”œâ”€â”€ packages/               # å·¥å…·åº“åŒ…
â”‚   â”œâ”€â”€ format/             # æ ¼å¼åŒ–å·¥å…· (v1.0.1)
â”‚   â”œâ”€â”€ typescript-config/  # TypeScript é…ç½® (v1.0.3)
â”‚   â”œâ”€â”€ eslint-config/      # ESLint é…ç½® (v1.0.2)
â”‚   â”œâ”€â”€ prettier-config/    # Prettier é…ç½® (v1.0.0)
â”‚   â””â”€â”€ type-utils/         # ç±»å‹å·¥å…· (å¼€å‘ä¸­)
â”œâ”€â”€ .changeset/             # Changesets é…ç½®
â”œâ”€â”€ .husky/                 # Git hooks
â”œâ”€â”€ commitlint.config.js    # æäº¤ä¿¡æ¯è§„èŒƒ
â”œâ”€â”€ package.json            # æ ¹package.json
â”œâ”€â”€ pnpm-workspace.yaml     # pnpmå·¥ä½œåŒºé…ç½®
â”œâ”€â”€ turbo.json              # Turborepoé…ç½®
â””â”€â”€ vitest.config.ts        # æµ‹è¯•é…ç½®
```

## åŒ…è¯´æ˜

### apps ç›®å½•

`apps` ç›®å½•åŒ…å«äº†å®Œæ•´çš„åº”ç”¨ç¨‹åºï¼Œè¿™äº›åº”ç”¨ç¨‹åºé€šå¸¸æ˜¯æ¶ˆè´¹ `packages` ä¸­çš„åŒ…ï¼š

- **docs**: æ–‡æ¡£ç½‘ç«™ï¼Œä½¿ç”¨ Docusaurus æ„å»º
- **web**: ç¤ºä¾‹ç½‘ç«™ï¼ˆå¦‚æœ‰ï¼‰

### packages ç›®å½•

`packages` ç›®å½•åŒ…å«äº†å¯å‘å¸ƒçš„ npm åŒ…ï¼š

- **format** (v1.0.1): æ•°å­—å’Œæ—¥æœŸæ ¼å¼åŒ–å·¥å…·ï¼ŒåŒ…å«å®Œæ•´æµ‹è¯•è¦†ç›–
- **typescript-config** (v1.0.3): å…±äº«çš„ TypeScript é…ç½®ï¼Œæ”¯æŒå¤šç§é¡¹ç›®ç±»å‹
- **eslint-config** (v1.0.2): å…±äº«çš„ ESLint é…ç½®ï¼Œæ”¯æŒ Next.js 15.x
- **prettier-config** (v1.0.0): å…±äº«çš„ Prettier é…ç½®ï¼ŒåŒ…å«å¯¼å…¥æ’åº
- **type-utils**: ç±»å‹å·¥å…·åº“ (è§„åˆ’ä¸­)

## å·¥ä½œåŸç†

### ä¾èµ–ç®¡ç†

æˆ‘ä»¬ä½¿ç”¨ pnpm ç®¡ç†ä¾èµ–ï¼Œå®ƒé€šè¿‡ç¡¬é“¾æ¥å…±äº«ä¾èµ–ï¼Œå‡å°‘ç£ç›˜ç©ºé—´å ç”¨å’Œå®‰è£…æ—¶é—´ã€‚

`pnpm-workspace.yaml` æ–‡ä»¶å®šä¹‰äº†å·¥ä½œåŒºï¼š

```yaml
packages:
    - 'apps/*'
    - 'packages/*'
```

åŒ…ä¹‹é—´çš„å†…éƒ¨ä¾èµ–ä½¿ç”¨ `workspace:*` åè®®ï¼š

```json
{
	"dependencies": {
		"@nxlibs/format": "workspace:*"
	}
}
```

### æ„å»ºç³»ç»Ÿ

æˆ‘ä»¬ä½¿ç”¨ Turborepo ä½œä¸ºæ„å»ºç³»ç»Ÿï¼Œå®ƒæä¾›äº†ï¼š

- **å¢é‡æ„å»º** - åªé‡æ–°æ„å»ºå˜æ›´çš„åŒ…
- **ä»»åŠ¡ç¼“å­˜** - ç¼“å­˜æ„å»ºç»“æœï¼Œæå‡é€Ÿåº¦
- **å¹¶è¡Œæ‰§è¡Œ** - åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨å¹¶è¡Œæ„å»º
- **ä¾èµ–å›¾åˆ†æ** - æ™ºèƒ½å¤„ç†åŒ…ä¹‹é—´çš„ä¾èµ–å…³ç³»

`turbo.json` å®šä¹‰äº†é¡¹ç›®ä¸­çš„å„ç§ä»»åŠ¡ï¼š

```json
{
	"$schema": "https://turbo.build/schema.json",
	"tasks": {
		"build": {
			"dependsOn": ["^build"],
			"inputs": ["$TURBO_DEFAULT$", ".env*"],
			"outputs": ["dist/**"]
		},
		"dev": {
			"cache": false,
			"persistent": true
		},
		"lint": {
			"dependsOn": ["^build"]
		},
		"typecheck": {
			"dependsOn": ["^build"]
		},
		"test": {
			"outputs": ["coverage/**"]
		}
	}
}
```

### æµ‹è¯•ç³»ç»Ÿ

æˆ‘ä»¬ä½¿ç”¨ Vitest ä½œä¸ºç»Ÿä¸€çš„æµ‹è¯•æ¡†æ¶ï¼š

- **å¿«é€Ÿæ‰§è¡Œ** - åŸºäº Vite çš„é«˜æ€§èƒ½æµ‹è¯•
- **TypeScript æ”¯æŒ** - åŸç”Ÿ TypeScript æ”¯æŒ
- **è¦†ç›–ç‡æŠ¥å‘Š** - å†…ç½®è¦†ç›–ç‡åˆ†æ
- **æ™ºèƒ½ç›‘å¬** - åªé‡æµ‹è¯•ç›¸å…³å˜æ›´

### ä»£ç å…±äº«

å…¬å…±é…ç½®å’Œå·¥å…·ä»¥åŒ…çš„å½¢å¼å…±äº«ï¼ŒåŒ…æ‹¬ï¼š

- TypeScript é…ç½®
- ESLint è§„åˆ™
- Prettier è§„åˆ™
- å·¥å…·å‡½æ•°

## å¼€å‘æµç¨‹

### æ–°å»ºåŒ…

åˆ›å»ºæ–°åŒ…çš„æ­¥éª¤ï¼š

1. åœ¨ `packages` ç›®å½•ä¸‹åˆ›å»ºæ–°ç›®å½•
2. æ·»åŠ  `package.json` å’Œå¿…è¦çš„æºæ–‡ä»¶
3. æ›´æ–° `pnpm-workspace.yaml`ï¼ˆå¦‚æœ‰å¿…è¦ï¼‰
4. å®‰è£…ä¾èµ– `pnpm install`

ç¤ºä¾‹ `package.json`ï¼š

```json
{
	"name": "@nxlibs/new-package",
	"version": "0.0.0",
	"main": "./dist/index.js",
	"module": "./dist/index.mjs",
	"types": "./dist/index.d.ts",
	"sideEffects": false,
	"license": "MIT",
	"files": ["dist/**"],
	"scripts": {
		"build": "tsup src/index.ts --format esm,cjs --dts",
		"dev": "tsup src/index.ts --format esm,cjs --watch --dts",
		"lint": "eslint \"src/**/*.ts\"",
		"test": "jest"
	}
}
```

### å¸¸ç”¨å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
pnpm install

# æ„å»ºæ‰€æœ‰åŒ…
pnpm turbo run build

# è¿è¡Œæµ‹è¯•ï¼ˆæ‰€æœ‰åŒ…ï¼‰
pnpm test

# è¿è¡Œæµ‹è¯•ï¼ˆå¸¦è¦†ç›–ç‡ï¼‰
pnpm test:coverage

# ç±»å‹æ£€æŸ¥
pnpm typecheck

# ä»£ç è§„èŒƒæ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm format

# å¯åŠ¨æ–‡æ¡£å¼€å‘æœåŠ¡å™¨
cd apps/docs && pnpm dev

# è¿‡æ»¤ç‰¹å®šåŒ…çš„æ“ä½œ
pnpm turbo run build --filter=@nxlibs/format
pnpm turbo run test --filter=@nxlibs/format
```

## å‘å¸ƒæµç¨‹

æˆ‘ä»¬ä½¿ç”¨ Changesets è¿›è¡Œç‰ˆæœ¬ç®¡ç†å’Œå‘å¸ƒï¼š

### 1. ç”Ÿæˆå˜æ›´é›†

```bash
# äº¤äº’å¼ç”Ÿæˆ changeset
pnpm changeset

# å°†é€‰æ‹©è¦å‘å¸ƒçš„åŒ…å’Œå˜æ›´ç±»å‹
# - patch: ä¿®å¤å’Œå°æ”¹è¿›
# - minor: æ–°åŠŸèƒ½
# - major: ç ´åæ€§å˜æ›´
```

### 2. ç‰ˆæœ¬æ›´æ–°

```bash
# è‡ªåŠ¨æ›´æ–°ç‰ˆæœ¬å·å’Œç”Ÿæˆ CHANGELOG
pnpm changeset version

# æäº¤ç‰ˆæœ¬å˜æ›´
git add .
git commit -m "chore: version packages"
```

### 3. å‘å¸ƒåˆ° npm

```bash
# æ„å»ºæ‰€æœ‰åŒ…
pnpm turbo run build

# å‘å¸ƒå˜æ›´çš„åŒ…
pnpm changeset publish

# æ¨é€ç‰ˆæœ¬æ ‡ç­¾
git push --follow-tags
```

### å‘å¸ƒæ£€æŸ¥æ¸…å•

- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] ç±»å‹æ£€æŸ¥é€šè¿‡  
- [ ] ä»£ç è§„èŒƒæ£€æŸ¥é€šè¿‡
- [ ] æ„å»ºæˆåŠŸ
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] Changeset å·²åˆ›å»º

## ä¼˜åŠ¿

- **ä»£ç å…±äº«** - åŒ…ä¹‹é—´å¯ä»¥å…±äº«ä»£ç ï¼Œé¿å…é‡å¤
- **ç»Ÿä¸€é…ç½®** - ç»Ÿä¸€çš„ä»£ç è§„èŒƒå’Œæ„å»ºæµç¨‹  
- **å¢é‡æ„å»º** - åªé‡å»ºæœ‰æ”¹åŠ¨çš„åŒ…ï¼Œæå‡æ•ˆç‡
- **å¹¶è¡Œæ‰§è¡Œ** - å……åˆ†åˆ©ç”¨ç³»ç»Ÿèµ„æºï¼Œæé«˜æ„å»ºé€Ÿåº¦
- **åŸå­æ›´æ”¹** - è·¨åŒ…ä¿®æ”¹å¯ä»¥åœ¨å•ä¸ªæäº¤ä¸­å®Œæˆ
- **ä¾èµ–ç®¡ç†** - é€šè¿‡ pnpm å®ç°é«˜æ•ˆçš„ä¾èµ–å…±äº«
- **ç‰ˆæœ¬åŒæ­¥** - ä½¿ç”¨ Changesets ç¡®ä¿ç‰ˆæœ¬ç®¡ç†çš„ä¸€è‡´æ€§
- **è´¨é‡ä¿è¯** - ç»Ÿä¸€çš„æµ‹è¯•ã€æ£€æŸ¥å’Œå‘å¸ƒæµç¨‹

## ğŸ¯ æœ€ä½³å®è·µ

### åŒ…è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£** - æ¯ä¸ªåŒ…ä¸“æ³¨äºå•ä¸€åŠŸèƒ½é¢†åŸŸ
2. **æœ€å° API** - ä¿æŒç®€æ´çš„å…¬å…±æ¥å£
3. **å‘åå…¼å®¹** - éµå¾ªè¯­ä¹‰åŒ–ç‰ˆæœ¬ï¼Œé¿å…ç ´åæ€§å˜æ›´
4. **æ–‡æ¡£å®Œæ•´** - æ¯ä¸ªåŒ…éƒ½æœ‰å®Œæ•´çš„ä½¿ç”¨æ–‡æ¡£å’Œç¤ºä¾‹

### ä¾èµ–ç®¡ç†åŸåˆ™

1. **æœ€å°ä¾èµ–** - åªæ·»åŠ å¿…è¦çš„ä¾èµ–
2. **å¯¹ç­‰ä¾èµ–** - åˆç†ä½¿ç”¨ peerDependencies é¿å…ç‰ˆæœ¬å†²çª
3. **å¼€å‘ä¾èµ–** - å·¥å…·ç±»ä¾èµ–æ”¾åœ¨æ ¹ç›®å½•ç»Ÿä¸€ç®¡ç†
4. **ç‰ˆæœ¬é”å®š** - ä½¿ç”¨ç¡®å®šçš„ç‰ˆæœ¬èŒƒå›´

### å¼€å‘å·¥ä½œæµ

1. **åŠŸèƒ½åˆ†æ”¯** - æ¯ä¸ªåŠŸèƒ½ä½¿ç”¨ç‹¬ç«‹åˆ†æ”¯å¼€å‘
2. **åŸå­æäº¤** - æ¯ä¸ªæäº¤ä¸“æ³¨äºå•ä¸ªå˜æ›´
3. **æµ‹è¯•é©±åŠ¨** - æ–°åŠŸèƒ½ä¼˜å…ˆç¼–å†™æµ‹è¯•
4. **æ–‡æ¡£åŒæ­¥** - ä»£ç å˜æ›´åŒæ­¥æ›´æ–°æ–‡æ¡£

## ğŸ“Š é¡¹ç›®æŒ‡æ ‡

### å½“å‰çŠ¶æ€

- **åŒ…æ•°é‡**: 4 ä¸ªå·²å‘å¸ƒåŒ… + 1 ä¸ªå¼€å‘ä¸­
- **æµ‹è¯•è¦†ç›–**: æ ¸å¿ƒåŠŸèƒ½åŒ…å«å®Œæ•´æµ‹è¯•
- **æ–‡æ¡£è¦†ç›–**: 100% åŒ…æ–‡æ¡£è¦†ç›–
- **å‘å¸ƒèŠ‚å¥**: åŸºäºéœ€æ±‚çš„æŒç»­å‘å¸ƒ

### æŠ€æœ¯å€ºåŠ¡ç®¡ç†

æˆ‘ä»¬æŒç»­å…³æ³¨å’Œæ”¹è¿›ï¼š

- ğŸ“ˆ **æµ‹è¯•è¦†ç›–ç‡æå‡** - ä¸ºæ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½æ·»åŠ æµ‹è¯•
- ğŸ”§ **æ„å»ºæ€§èƒ½ä¼˜åŒ–** - åˆ©ç”¨ Turbo ç¼“å­˜å’Œå¹¶è¡Œæ„å»º
- ğŸ“ **æ–‡æ¡£å®Œå–„** - ä¿æŒæ–‡æ¡£ä¸ä»£ç åŒæ­¥
- ğŸš€ **CI/CD é›†æˆ** - è®¡åˆ’åŠ å…¥è‡ªåŠ¨åŒ–æµ‹è¯•å’Œå‘å¸ƒ
